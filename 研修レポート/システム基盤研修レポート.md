# システム基盤概要

## オープンシステム
ベンダー固定されずにアプリケーション・ミドルウェアの選択が可能。  
OSとミドルウェアの整合性など組み合わせの考慮や整合性の検証などメインフレームを使用する場合に比べて対応する作業が増加する。  
製品ごとに最新技術を自由に選択できる等のメリットがある反面、品質確保の難易度が上がる。  

## 大規模システム
大規模システムにおいてはシステム構造の複雑さが原因でトラブルの原因の追求に時間がかかる場合が多い。  
インフラ側が直接的な原因でない、パラメータ誤り等のソフトウェア原因の障害の場合であっても原因追求に時間がかかる。  
事前にリスクを想定し、それに対応できる信頼性・可用性を満たすITアーキテクチャの設計が必須。  

ITアーキテクチャ:情報処理システム全体の処理方式
- 業務機能面のアーキテクチャ  
- システム基盤(非機能的側面)のアーキテクチャ:インフラSEが顧客ヒアリングを担当 

システム開発は業務機能面、非機能面での分担が必要。  

## システム基盤側の要件定義
システム開発の要件定義工程の要件は「機能要件」「非機能要件」に分類される。  
「機能要件」は業務要件のため、アプリエンジニアが担当、「非機能要件」はシステム基盤の要件のため、インフラエンジニアが担当するのが一般的。  

「非機能要件定義」では以下の5項目の要件を明確にする。  
- 可用性：提供するシステムの機能が一定以上の水準の壊れにくさとなっていること  
- 拡張性：必要に応じてシステム資源の追加・増強が効率的に行えること  
- 運用性：システムの維持に適切なサービスレベルを保った上で、稼働し続けられるようにすること  
- 性能：システムの機能がユーザの満足できる時間内に応答できること  
- セキュリティ：システムの機密性・完全性を確保できること  

各要件に曖昧な場合が多くあるため、非機能要件は数値化することで明確にする。  
非機能要件定義では、非機能要件の標準ドキュメントである「IPA 非機能要求グレード」を使用して進めることが一般的。  
https://www.ipa.go.jp/sec/reports/20180425.html  

システム基盤担当者は業務担当者と共同しながら要件定義を進める必要がある。  
業務担当者とはお互いのやること、責任範囲をリスト化し予め責任範囲を握ることが重要。  
非機能要件を具体化する際、品質・納期・コストの3点すべてを顧客にとってベストにすることが理想的であるが、すべてをベストにすることは現実的には難しい。  
それぞれどの程度の割合で重視するかに関しては、予め顧客とベンダーとの間で優先度を合わせる作業を必ず行う必要がある。  

# システム基盤の役割(上流工程)

## システム基盤の開発プロセス
システム基盤開発のプロセスは、大きく要件定義フェーズ・設計フェーズ・実装フェーズ・テストフェーズに分けられる。  
要件定義フェーズ、設計フェーズの以下工程を上流工程とする。

要件定義フェーズ  
- 作業計画立案：プロジェクト計画を作成、プロジェクト運営のための管理方法の準備  
- 要件定義：顧客と要件を整理し、システム化の範囲やシステムの概略を設計する(インフラ側の要件定義では非機能要求グレードを埋める)  

設計フェーズ
- 方式設計：要件定義を受け、要件を満たすシステムの方式・運用方式などを確定させる

方式設計においてはOS、メモリなど具体的な内容は決めず、要件定義で決まった要件をどのようにシステムに落とし込んでいくかを決める。  
上流工程の「要件定義・方式設計」がプロジェクト全体のベースとなるため、プロジェクト全体でも特に重要な工程となる。  
要件を具体化する中で、特に性能の向上とセキュリティの向上はトレードオフの関係になるため注意が必要。  
※暗号化することでセキュリティを向上させることができるが、その分CPU負荷が大きくなり性能ダウンにつながるなど  

## 作業計画立案
プロジェクトの作業計画立案にあたっては、以下を行う必要がある。  
- マスタスケジュールの作成  
  各工程の定義、マイルストーン、他システムとの連携時期を確認する。
  言葉の定義は顧客・ベンダー間で認識が異なることが多々あるため、この時点ですり合わせる。  
- 作業スケジュールの作成  
  設計、構築、テストの時期・期間を決定する。
- 開発形態・開発拠点の明確化  
  特にパブリッククラウドを使用する場合はテスト場所を明確化する。  

## 要件定義
顧客からのRFPをもとに要件を整理し「要件定義書」という形で顧客の要件をまとめる。  
「RFP(提案依頼書)」：開発すべきシステムの要件を顧客がベンダーに示す文書。ベンダー側はRFP、ヒアリングで得た情報、現行システムの情報をもとに要件を整理し顧客に提案する。  
要件定義においては「速やかに」「極力」等の曖昧な表現は避け、数値で具体化する。  
特に非機能要件定義に関しては、顧客側から明確な要件がいつも出る訳ではないため、インフラ担当者側から提案をすることも大切。  
具体化が難しい要件に関してはリスクとして、課題管理・SLAに反映する。  
プロジェクトを円滑に進める上で、課題管理は必要不可欠な作業。  
非機能要件定義において非機能要求グレードでその時点で決められないものは、すべて課題にあたるため課題管理表等でいつまでに解決するかをその時点で明確にする。  
その課題の解決だけでなく、課題解決後は課題の横展開の確認も重要。  

### 可用性要件
要件定義における可用性要件のポイントは以下の3点。  
- オンライン業務の継続性
- バッチ業務の継続性
- システムの冗長化

可用性要件においてはオンライン業務とバッチ業務は切り分けて考える。  
「可用性」は一般的に情報システムの品質および障害の発生、影響範囲および回復の度合いと定義される。  
可用性を高めるほどコストも増加する。  
代表的なシステムの冗長構成は「ホットスタンバイシステム」「ロードバランスシステム」  
- ホットスタンバイシステム
  複数のコンピュータを構成する方式。
  主系システムでメイン業務を行い、従系システムも同様にプログラムを起動し待機する。
  データベースで使用されることが多い方式。  
- ロードバランスシステム
  複数のコンピュータで負荷を分散させ、処理性能を向上させる。
  障害発生時には縮退運転を行い、可用性を実現する。

### 拡張性要件
要件定義における拡張性要件のポイントは以下の4点。  
- 機器のライフサイクル
- ハードウェアの現状構成
- ハードウェアの追加構成
- ソフトウェアの現状構成

拡張性を高めるほどコストも増加する。  
処理能力不足時、障害時に対して性能を確保する必要がある。  
拡張性の確保の方法は一般的にスケールアウト・スケールアップの2つである。  
- スケールアウト
  サーバ数を増加させてパフォーマンスを向上する。
  サーバ数を増やせば増やすほど処理能力の向上が期待できる。
  サーバ側で保持するデータがサーバ数を増やすことで各サーバに分散されるのでデータの一貫性は保てなくなる。
  Webサーバ、APサーバに適している。  
- スケールアップ
  既存のサーバの機能を強化する。  
  データの一貫性を保持できる。  
  サーバに搭載可能なプロセッサ数、メモリ容量は決まっているため拡張に限界がある。  
  データの一貫性に適しているためデータベースサーバに利用されるケースが一般的。  

### 性能要件
要件定義における性能要件のポイントは以下の4点。  
- オンライン処理の時間
- バッチ処理の時間
- 帳票・外部媒体の時間：外部媒体を使用する場合の入出力時間
- リカバリーの時間：障害発生時の復旧時間

オンライン処理とバッチ処理の時間は分けて考える。  
性能要件を高めすぎると開発時の大きな負担となることがあり、リスクとなる。  
定義条件に関しては具体的に数値化する必要がある。  

## 機能実現のために使用する各装置

### Webサーバ・APサーバ・DBサーバ
- Webサーバ
  クライアントからの要求に対応するサーバ。
  クライアントの要求の内容に応じてAPサーバ(アプリ)に処理の依頼を行う。
  Webサーバは外部から直接攻撃を受けるリスクがあるため、早期にパッチを適用するなどセキュリティを重視する必要がある。
  性能はマルチサーバ化をすることで高めることが一般的。
- APサーバ
  Webサーバからの処理の要求に対して結果を返す。
  Webサーバ同様、性能はマルチサーバ化をすることで高めることが一般的。
- DBサーバ
  ハードディスクにデータを書き込む。
  APサーバからのデータアクセス要求に対してデータに対する処理を行う。
  性能はスケールアップによって高めることが一般的。

### 負荷分散装置
負荷分散装置によりクライアントからのアクセスを動的に複数の機器に振り分ける。  
- メリット
  負荷振り分け先の機器の稼働状況の監視が可能。  
  SSLアクセラレータを使用することでデータの暗号化・複合化を高速で行うことが可能。
- デメリット
  負荷分散装置の導入コストが高い。
  管理、メンテナンスコストが発生する。

### ファイアウォール
アクセス制御を行う。  
DMZ、イントラネットゾーン、インターネットゾーンをファイアウォールで分割する。  
IPアドレス、ポート番号などで通信を制御しDMZ、イントラネットのセキュリティを高める。  
グローバルIPアドレスと、DMZ、内部で使うIPアドレスを変換して中継する。  
外部と内部との通信をすべてログに記録する。  
ファイアウォールにアンチウイルス機能を付加した専用装置をUTMという。  
- インターネット
  システム外部のネットワーク
- DMZ
  セキュリティを考慮しつつ外部との直接通信を行う空間
  DNSサーバ、Webサーバ等を配置するのが一般的
- イントラネット
  外部との通信を行わない部分。
  APサーバ、DBサーバ等を配置するのが一般的

## システム構成
大規模システムにおいては拡張性・信頼性を高めるシステム構成とする必要がある。  
大規模システムにおいてはWeb、AP、DBサーバをそれぞれ二重化以上の冗長化構成としWebサーバの両端にファイアウォールを配置することでDMZを作成する。  
システム構成の検討にあたっては拡張性・信頼性を考慮し顧客の業務形態にあった構成を選択することが必要。  
3階層システム:サーバをWeb、AP、DBの3つに分離させる構成。  
3階層システムにすることによりサーバ機能を分離でき、各々のパフォーマンスを最大限に発揮することができる。  
保守性・開発性の向上につながる。  
サーバをクラスタ化することにより片方のサーバが停止しても、継続して処理を行うことができる。   
片方のサーバで処理が停止した場合、もう片方のサーバが処理を引き継ぐことによりシステムの運用を継続する。  
DBサーバではデータを共有ディスクに書き込むことで、どちらのサーバからも共有ディスクを読むことができるようにしている。 

### 拡張性・信頼性
DBサーバではクラスタ構成(複数台構成)にすることが一般的で、単体構成と比較してシステムの可用性を向上させることができる。 
クラスタ構成では実際に動いているのは1台のみのため向上するのは可用性のみにとどまる。  
Webサーバ・APサーバのそれぞれに負荷分散装置を振り分ける構成にした場合、冗長性に優れ高い可用性を実現できる。  
Webサーバに対してのみ負荷分散装置を配置した場合、処理経路が少なくなりトラブル時の切り分けが容易になるがシステムの可用性は低くなる。  

### 昨今のシステム基盤の技術
- ブレードサーバ
  各業務で使用するサーバを集約することができる。  
  各々で行っていたサーバのバックアップ、トラブル時の復旧作業を一元的に行うことができる。
  集約することでサーバの設置スペース、機器に接続するケーブルの本数などの面でコストを削減することができる。  
  一方で冷却対策のための騒音が非常に大きい、使用に200V電源が必要、ブレードサーバを取り扱うベンダーの減少などの問題もある。  
- ストレージシステム
  コンピュータとストレージをネットワークで接続して使用する形態。  
  SANとNASが一般的。  
  - SAN
    ファイバーチャネルを使用してサーバとストレージをネットワーク。
    大容量データの読み書きを行った場合でもLANへの負荷をかけない。  
    大規模システム導入時に採用されることが多い。
    サーバとストレージの接続に専用のスイッチが必要になる。  
  - NAS
    サーバとストレージの接続にLANを用いる。
    既存のLANを使用できるのでSANよりも導入費用が安いことが多い。  
- 各プラットフォームのサポート期間
  UNIXサーバ・Linuxサーバ・Windowsサーバによってそれぞれサポート期間が異なる。  
  UNIX:10年、ストレージ:7年、PCサーバ:5年  

## 運用要件定義
業務システムを安定、安全に運用するために運用要件を整理する。  
運用要件の定義のポイントは以下の4点。  
- 運用タイムチャート
  1日の運用のタイムチャートを作成する。  
- 定常運用
  起動・停止の方法、監視の有無、ログ・ストレージ・セキュリティ管理、オンライン・バッチ・バックアップ運用等。
- 障害時運用
- 保守運用
  計画停止の有無

漏れなく運用パターンを洗い出し、整理する必要がある。
運用整理・設計の過程で重要なことは「運用設計書」という形でドキュメントに反映する。
「運用設計書」は最新化が必須である。   
計画停止を実施するのか等の保守要件に関しても要件定義の一環で整理することが必要。  

## 移行要件定義
旧システムから新システムへの移行、開発環境から本番環境への移行における要求や仕様をまとめたもの。
ベンダー側で移行計画案を作成し、移行計画案をもとに顧客とベンダー間で移行要件を定義する。  
移行にはアプリ側の仕様が関わる場合が多いため移行作業開始前にアプリ側との意識合わせをすることが必要。  

## セキュリティ要件定義
システムのセキュリティ対策の基本は、システムの機密性が維持されること、システムの可用性が確保されること、データの保全性が確保されていること。  
- 機密性
  不正なアクセスが防止されていること。
  正当な利用者だけがシステムにアクセス可能であること。
  データの改ざん、盗聴などが行えないこと。
- 可用性
  利用者が必要に応じていつでもシステムを利用できること。
  システムが常に正常に稼働していること。
- 保全性
  利用者がいつでもシステムの適切なデータを使用できる状態。
  システム内のデータが常に正確で正常に保たれている状態。

可用性の観点で、監視の定義を行う際にアラート発生時のメールの通知先を予め確認する必要がある。  
システムの安全性・管理体制を定義する必要がある。  

## システム構成の決定
要件定義、システム方式の検討を行った上で、システム構成を確定させる。  
プラットフォームを選定後、安全性・拡張性を考慮するサイジングを行い、要件定義で定めた要件を満たす資源を確保していく。  
必要に応じてサーバの冗長化を行い、信頼性を高める策を実施する。  
特にWebサーバに関しては能力を確保するために1台がシステムダウンしても稼働し続けられる構成にする必要がある。  

# システム基盤の役割(下流工程)

## システム基盤の開発プロセス
システム基盤開発のプロセスは、大きく要件定義フェーズ・設計フェーズ・実装フェーズ・テストフェーズに分けられる。  
設計フェーズの環境設計、実装フェーズ、テストフェーズを下流工程とする。  

環境構築手順の作成は「IPA サーバ環境構築手順書」を標準ドキュメントとして使用する。  
https://www.ipa.go.jp/files/000018659.pdf  

環境構築手順書をもとに事前に環境構築手順を明確にし、レビューを重ね質の高い環境構築手順書に仕上げることが重要。  
作成した環境構築手順書に従い、確実に構築作業を進めること、ログなどのエビデンスを残すことも重要。  

## 環境設計
環境設計では以下の8項目を定める必要がある。  
- ハードウェア設計  
  環境設計で設計したハードウェア構成をもとに各物理装置の詳細設計を行う。    
  実際に配置するフロアを確認し、機器装置レイアウト図を設計する。    
  機器の設置位置、物理装置ごとの実装位置の設計を行う。  
- ディスク構成設計  
  ディスク装置障害に対応できるよう信頼性の高いディスク構成設計を行う。  
  復旧作業時間帯の検討を行う。(業務データは即時復旧、アクセスログは保守時に復旧など)  
  ディスクの空き状態などディスク装置の状態監視方法を定める。  
- ディレクトリ構成設計  
  アプリ担当者が開発資材を勝手に配置することを避けるためにファイルサーバのフォルダ階層を設計する。  
  設計内容をもとにアプリ側と意識を合わせられる。  
  ディレクトリに権限を持たせることでセキュリティを担保できる。  
  バックアップ、ファイルの一元管理が楽になる。  
  異なる性格のファイルが同じフォルダ、階層に存在することを避け運用をスムーズにできる等の利点がある。  
- アクセスパス設計  
  フォルダ設計の一部。  
  OS・ミドルウェアのパスを正しく設定する。  
  システム全体でアクセスパスの標準化を行うことが必要。  
  パスが正しく設定されていないとシステムやアプリが起動しないトラブルが発生する。  
  アクセスパス設計はインフラ担当者が率先してルールを決めることが必要。  
- データベース物理設計  
  論理設計したデータベースを実装できる段階まで落とし込む設計。  
  - 格納構造の設計  
    格納するデータのグループ化を定義。  
    読み取り主体か書き込み主体かに応じて格納の構造を設計する。  
    必要容量の確認。  
  - ページサイズの設計  
  - ボリューム配置  
  - バッファサイズを設定  
- 一般ファイル設計  
  データベース関連データ以外のファイルを指す。  
  アプリによってファイルが破壊された場合のリカバリー方法を考える。  
  ファイル削除のタイミングを考える。  
  ディレクトリ構成設計に一般ファイルに関しても反映させる。  
- OS・ミドルウェア環境設計  
  IPアドレス等のネットワーク関連設計、OS・ミドルウェアに設定するパラメータ設計、インストールするパッケージのバージョンの選択等を明らかにする。  
  環境構築手順書を確認し、設計内容がシステム全体で整合性が取れているかを確認する。  
- 修正適用指針・適用計画作成  
  パッチ当ては本番環境で行う前に、開発環境等で先に実施し影響の確認を行う。  
  何をもってパッチ当てが成功したかについては、顧客側と責任範囲を予め決めることが重要になる。  
  セキュリティパッチ：ウイルス対策ソフトのパターンファイルの最新化、セキュリティホールを塞ぐために当てるパッチ。すべてのサーバ、端末に確実に当てる必要がある。  

## 性能設計  
システムの性質を理解し、システム要件全体に見合う能力を発揮できるよう設計を行うこと。  
与えられた環境の中で、どう性能と業務要件のバランスを取るのかが重要になる。  
性能と業務要件はトレードオフの関係にある。  
開発後は性能設計通りに構築が行われたかを性能検証によって確認する、目的は以下の3点である。  
- 性能設計の通りに動作していることを確認する。  
- 単体テスト、結合テスト時に意図した性能が発揮されるかを確認する。  
- 性能目標を達成できているかを確認する。  

  

